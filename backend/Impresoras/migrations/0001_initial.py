# Generated by Django 6.0 on 2025-12-04 10:08

import django.core.validators
import django.db.models.deletion
import django.utils.timezone
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Department',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('code', models.CharField(max_length=10, unique=True, verbose_name='Código')),
                ('name', models.CharField(max_length=100, verbose_name='Nombre')),
                ('department_type', models.CharField(choices=[('ENG', 'Ingeniería'), ('DES', 'Diseño'), ('ARC', 'Arquitectura'), ('ART', 'Arte'), ('SCI', 'Ciencias'), ('TEC', 'Tecnología'), ('OTH', 'Otro')], default='OTH', max_length=3, verbose_name='Tipo de Departamento')),
                ('description', models.TextField(blank=True, verbose_name='Descripción')),
                ('active', models.BooleanField(default=True, verbose_name='Activo')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Departamento',
                'verbose_name_plural': 'Departamentos',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='PricingConfig',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, verbose_name='Nombre de la Configuración')),
                ('active', models.BooleanField(default=True, verbose_name='Activa')),
                ('cost_per_hour', models.DecimalField(decimal_places=2, max_digits=10, verbose_name='Costo por Hora (CUP)')),
                ('cost_per_gram', models.DecimalField(decimal_places=2, max_digits=10, verbose_name='Costo por Gramo (CUP)')),
                ('pla_multiplier', models.DecimalField(decimal_places=2, default=1.0, max_digits=5, verbose_name='Multiplicador PLA')),
                ('abs_multiplier', models.DecimalField(decimal_places=2, default=1.2, max_digits=5, verbose_name='Multiplicador ABS')),
                ('petg_multiplier', models.DecimalField(decimal_places=2, default=1.1, max_digits=5, verbose_name='Multiplicador PETG')),
                ('resin_multiplier', models.DecimalField(decimal_places=2, default=2.0, max_digits=5, verbose_name='Multiplicador Resina')),
                ('student_discount', models.DecimalField(decimal_places=2, default=0.2, max_digits=5, verbose_name='Descuento Estudiantes (%)')),
                ('teacher_discount', models.DecimalField(decimal_places=2, default=0.1, max_digits=5, verbose_name='Descuento Profesores (%)')),
                ('min_billing_hours', models.DecimalField(decimal_places=2, default=0.5, max_digits=5, verbose_name='Horas Mínimas de Facturación')),
                ('commission_percentage', models.DecimalField(decimal_places=2, default=0.0, max_digits=5, verbose_name='Comisión (%)')),
                ('valid_from', models.DateTimeField(default=django.utils.timezone.now, verbose_name='Válido Desde')),
                ('valid_to', models.DateTimeField(blank=True, null=True, verbose_name='Válido Hasta')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Configuración de Precios',
                'verbose_name_plural': 'Configuraciones de Precios',
                'ordering': ['-valid_from'],
            },
        ),
        migrations.CreateModel(
            name='Printer',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('serial_number', models.CharField(max_length=50, unique=True, verbose_name='Número de Serie')),
                ('name', models.CharField(max_length=100, verbose_name='Nombre')),
                ('brand', models.CharField(max_length=50, verbose_name='Marca')),
                ('model', models.CharField(max_length=50, verbose_name='Modelo')),
                ('printer_type', models.CharField(choices=[('FDM', 'FDM/FFF (Filamento)'), ('SLA', 'SLA (Resina)'), ('SLS', 'SLS (Polvo)'), ('DLP', 'DLP (Resina)')], default='FDM', max_length=3, verbose_name='Tipo de Impresora')),
                ('status', models.CharField(choices=[('AVA', 'Disponible'), ('PRI', 'Imprimiendo'), ('MAI', 'En Mantenimiento'), ('RES', 'Reservada'), ('OUT', 'Fuera de Servicio')], default='AVA', max_length=3, verbose_name='Estado')),
                ('build_volume_x', models.FloatField(verbose_name='Volumen X (mm)')),
                ('build_volume_y', models.FloatField(verbose_name='Volumen Y (mm)')),
                ('build_volume_z', models.FloatField(verbose_name='Volumen Z (mm)')),
                ('max_temperature', models.FloatField(blank=True, null=True, verbose_name='Temperatura Máxima (°C)')),
                ('supported_materials', models.CharField(help_text='Separados por comas', max_length=200, verbose_name='Materiales Soportados')),
                ('location', models.CharField(max_length=100, verbose_name='Ubicación')),
                ('purchase_date', models.DateField(verbose_name='Fecha de Compra')),
                ('warranty_expiry', models.DateField(blank=True, null=True, verbose_name='Fin de Garantía')),
                ('hourly_cost', models.DecimalField(decimal_places=2, default=0, max_digits=10, verbose_name='Costo por Hora (CUP)')),
                ('maintenance_interval_hours', models.IntegerField(default=500, verbose_name='Intervalo de Mantenimiento (horas)')),
                ('total_print_hours', models.FloatField(default=0, verbose_name='Horas Totales de Impresión')),
                ('notes', models.TextField(blank=True, verbose_name='Notas')),
                ('is_active', models.BooleanField(default=True, verbose_name='Activa')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('department', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='printers', to='Impresoras.department', verbose_name='Departamento Asociado')),
            ],
            options={
                'verbose_name': 'Impresora',
                'verbose_name_plural': 'Impresoras',
                'ordering': ['name', 'brand'],
            },
        ),
        migrations.CreateModel(
            name='PrintJob',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('job_id', models.UUIDField(default=uuid.uuid4, editable=False, unique=True, verbose_name='ID del Trabajo')),
                ('file_name', models.CharField(max_length=255, verbose_name='Nombre del Archivo')),
                ('file_size', models.IntegerField(verbose_name='Tamaño del Archivo (bytes)')),
                ('file_url', models.URLField(blank=True, max_length=500, verbose_name='URL del Archivo')),
                ('material_type', models.CharField(choices=[('PLA', 'PLA'), ('ABS', 'ABS'), ('PET', 'PETG'), ('TPU', 'TPU (Flexible)'), ('RES', 'Resina'), ('NYL', 'Nylon'), ('OTH', 'Otro')], default='PLA', max_length=3, verbose_name='Tipo de Material')),
                ('material_weight', models.FloatField(validators=[django.core.validators.MinValueValidator(0.1)], verbose_name='Peso del Material (g)')),
                ('estimated_hours', models.FloatField(validators=[django.core.validators.MinValueValidator(0.1)], verbose_name='Horas Estimadas')),
                ('actual_hours', models.FloatField(blank=True, null=True, verbose_name='Horas Reales')),
                ('layer_height', models.FloatField(blank=True, null=True, verbose_name='Altura de Capa (mm)')),
                ('infill_percentage', models.IntegerField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)], verbose_name='Porcentaje de Relleno (%)')),
                ('supports', models.BooleanField(default=False, verbose_name='Usa Soporte')),
                ('status', models.CharField(choices=[('PEN', 'Pendiente'), ('APP', 'Aprobado'), ('PRI', 'Imprimiendo'), ('PAU', 'Pausado'), ('COM', 'Completado'), ('CAN', 'Cancelado'), ('FAI', 'Fallido')], default='PEN', max_length=3, verbose_name='Estado')),
                ('priority', models.IntegerField(default=5, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(10)], verbose_name='Prioridad (1-10)')),
                ('approved_at', models.DateTimeField(blank=True, null=True, verbose_name='Aprobado en')),
                ('started_at', models.DateTimeField(blank=True, null=True, verbose_name='Iniciado en')),
                ('completed_at', models.DateTimeField(blank=True, null=True, verbose_name='Completado en')),
                ('cancelled_at', models.DateTimeField(blank=True, null=True, verbose_name='Cancelado en')),
                ('estimated_cost', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True, verbose_name='Costo Estimado (CUP)')),
                ('actual_cost', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True, verbose_name='Costo Real (CUP)')),
                ('paid', models.BooleanField(default=False, verbose_name='Pagado')),
                ('notes', models.TextField(blank=True, verbose_name='Notas')),
                ('error_message', models.TextField(blank=True, verbose_name='Mensaje de Error')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_jobs', to=settings.AUTH_USER_MODEL, verbose_name='Aprobado por')),
                ('printer', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='print_jobs', to='Impresoras.printer', verbose_name='Impresora')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='print_jobs', to=settings.AUTH_USER_MODEL, verbose_name='Usuario')),
            ],
            options={
                'verbose_name': 'Trabajo de Impresión',
                'verbose_name_plural': 'Trabajos de Impresión',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='UserPricingProfile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('balance', models.DecimalField(decimal_places=2, default=0, max_digits=12, verbose_name='Saldo (CUP)')),
                ('credit_limit', models.DecimalField(decimal_places=2, default=1000.0, max_digits=12, verbose_name='Límite de Crédito (CUP)')),
                ('last_payment_date', models.DateTimeField(blank=True, null=True, verbose_name='Última Fecha de Pago')),
                ('total_spent', models.DecimalField(decimal_places=2, default=0, max_digits=12, verbose_name='Total Gastado (CUP)')),
                ('discount_percentage', models.DecimalField(decimal_places=2, default=0, max_digits=5, verbose_name='Descuento Personal (%)')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('pricing_config', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='Impresoras.pricingconfig', verbose_name='Configuración de Precios')),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='pricing_profile', to=settings.AUTH_USER_MODEL, verbose_name='Usuario')),
            ],
            options={
                'verbose_name': 'Perfil de Precios de Usuario',
                'verbose_name_plural': 'Perfiles de Precios de Usuario',
            },
        ),
        migrations.CreateModel(
            name='UserProfile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('role', models.CharField(choices=[('STU', 'Estudiante'), ('TEA', 'Profesor'), ('TEC', 'Técnico'), ('ADM', 'Administrador'), ('EXT', 'Externo')], default='STU', max_length=3, verbose_name='Rol')),
                ('student_id', models.CharField(blank=True, max_length=20, null=True, verbose_name='Carné de Estudiante')),
                ('phone', models.CharField(blank=True, max_length=15, verbose_name='Teléfono')),
                ('address', models.TextField(blank=True, verbose_name='Dirección')),
                ('is_verified', models.BooleanField(default=False, verbose_name='Verificado')),
                ('max_concurrent_jobs', models.IntegerField(default=1, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(5)], verbose_name='Máximo de Trabajos Concurrentes')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('department', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='user_profiles', to='Impresoras.department', verbose_name='Departamento')),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='profile', to=settings.AUTH_USER_MODEL, verbose_name='Usuario')),
            ],
            options={
                'verbose_name': 'Perfil de Usuario',
                'verbose_name_plural': 'Perfiles de Usuario',
                'ordering': ['user__last_name', 'user__first_name'],
            },
        ),
        migrations.CreateModel(
            name='SystemLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('log_id', models.UUIDField(default=uuid.uuid4, editable=False, unique=True)),
                ('action', models.CharField(choices=[('CRE', 'Creación'), ('UPD', 'Actualización'), ('DEL', 'Eliminación'), ('LOG', 'Inicio de Sesión'), ('OUT', 'Cierre de Sesión'), ('PST', 'Inicio de Impresión'), ('PEN', 'Fin de Impresión'), ('PAY', 'Pago'), ('ERR', 'Error')], max_length=3, verbose_name='Acción')),
                ('model_name', models.CharField(max_length=100, verbose_name='Nombre del Modelo')),
                ('object_id', models.CharField(max_length=100, verbose_name='ID del Objeto')),
                ('description', models.TextField(verbose_name='Descripción')),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True, verbose_name='Dirección IP')),
                ('user_agent', models.TextField(blank=True, verbose_name='User Agent')),
                ('before_data', models.JSONField(blank=True, null=True, verbose_name='Datos Antes')),
                ('after_data', models.JSONField(blank=True, null=True, verbose_name='Datos Después')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='system_logs', to=settings.AUTH_USER_MODEL, verbose_name='Usuario')),
            ],
            options={
                'verbose_name': 'Log del Sistema',
                'verbose_name_plural': 'Logs del Sistema',
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['action', 'created_at'], name='Impresoras__action_e25df7_idx'), models.Index(fields=['model_name', 'object_id'], name='Impresoras__model_n_77e953_idx'), models.Index(fields=['user', 'created_at'], name='Impresoras__user_id_a5c737_idx')],
            },
        ),
        migrations.CreateModel(
            name='UserPrinterAssignment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('active', models.BooleanField(default=True, verbose_name='Activa')),
                ('start_date', models.DateTimeField(default=django.utils.timezone.now, verbose_name='Fecha Inicio')),
                ('end_date', models.DateTimeField(blank=True, null=True, verbose_name='Fecha Fin')),
                ('reason', models.TextField(verbose_name='Razón de Asignación')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_assignments', to=settings.AUTH_USER_MODEL, verbose_name='Creado por')),
                ('printer', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='user_assignments', to='Impresoras.printer', verbose_name='Impresora')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='printer_assignments', to=settings.AUTH_USER_MODEL, verbose_name='Usuario')),
            ],
            options={
                'verbose_name': 'Asignación Usuario-Impresora',
                'verbose_name_plural': 'Asignaciones Usuario-Impresora',
                'ordering': ['-start_date'],
                'unique_together': {('user', 'printer', 'active')},
            },
        ),
    ]
